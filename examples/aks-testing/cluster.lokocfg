variable "subscription_id" {}
variable "tenant_id" {}
variable "grafana_admin_password" {}
variable "resource_group_name" {}
variable "application_name" {}
variable "cert_manager_email" {}

variable "asset_dir" {
  default = "./lokomotive-assets"
}

variable "cluster_name" {
  default = "lokomotive-cluster"
}

variable "workers_count" {
  default = 1
}

variable "workers_type" {
  default = "Standard_D2_v2"
}

variable "location" {
  default = "West Europe"
}

cluster "aks" {
  asset_dir    = pathexpand(var.asset_dir)
  cluster_name = var.cluster_name

  subscription_id     = var.subscription_id
  tenant_id           = var.tenant_id
  location            = var.location
  resource_group_name = var.resource_group_name
  application_name    = var.application_name

  worker_pool "default" {
    vm_size = var.workers_type
    count   = var.workers_count
  }
}

component "prometheus-operator" {
  grafana_admin_password = var.grafana_admin_password
  disable_webhooks       = true
}

component "cert-manager" {
  email           = var.cert_manager_email
  service_monitor = true
}

component "contour" {
  service_monitor = true
}
